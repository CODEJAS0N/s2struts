<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd"><html><!-- don't edit start --><head><title>Seasar - DI Container with AOP - </title><meta http-equiv="Content-Type" content="text/html; charset=Shift_JIS"><link href="seasar_b.css" type="text/css" rel="stylesheet"><script src="seasar_b.js" type="text/JavaScript" language="JavaScript"></script></head><body onload="preload('ja')"><table width="100%" border="0" cellspacing="0" cellpadding="0" align="left" height="100%"><tr><td align="left" valign="top" width="780"><table width="780" border="0" cellspacing="0" cellpadding="0" class="white"><tr><td colspan="7"><img height="5" width="780" src="images/top01_b.gif" alt=""></td></tr><tr><td><img height="117" width="235" src="images/top02_b.gif" alt="Seasar"></td><td colspan="3"><img height="117" width="289" src="images/top03.gif" alt="DI Container with AOP"></td><td colspan="3"><img height="117" width="256" src="images/spacer.gif" alt=""></td></tr><tr><td rowspan="2"><img src="images/top04.gif" alt="" height="49" width="235"></td><td><a href="index.html"><img src="images/menu01_b_ja.gif" height="30" width="78" border="0" alt="" id="menu01" onmouseover="swap(1)" onmouseout="restore(1)"></a></td><td><a href="http://sourceforge.jp/projects/seasar"><img src="images/menu02_b_ja.gif" height="30" width="101" border="0" alt="" id="menu02" onmouseover="swap(2)" onmouseout="restore(2)"></a></td><td><a href="download.html"><img src="images/menu03_b_ja.gif" height="30" width="110" border="0" alt="" id="menu03" onmouseover="swap(3)" onmouseout="restore(3)"></a></td><td><a href="document.html"><img src="images/menu04_b_ja.gif" height="30" width="113" border="0" alt="" id="menu04" onmouseover="swap(4)" onmouseout="restore(4)"></a></td><td><a href="resource.html"><img src="images/menu05_b_ja.gif" height="30" width="109" border="0" alt="" id="menu05" onmouseover="swap(5)" onmouseout="restore(5)"></a></td><td><img height="30" width="34" src="images/menu06.gif" alt=""></td></tr><tr><td colspan="6"><img height="19" width="545" src="images/spacer.gif" alt=""></td></tr></table><table  width="780" border="0" cellspacing="0" cellpadding="0" height="100%" class="white"><tr align="left" valign="top"><td width="14"><img height="14" width="14" src="images/spacer.gif" alt=""></td><td width="752" class="main"><!-- don't edit end --><!-- document start --><ul><li><a href="#Summary">S2Struts概要</a></li><li><a href="#Setup">動作環境とEclipseプロジェクトのセットアップ</a></li><li><a href="#Usage">基本的な使い方</a></li><li><a href="#ProxyAction">ProxyActionクラスの使い方</a></li><li><a href="#NoType">struts-config内に記述しているactionの、type属性を記述せずにActionクラスを指定する</a></li><li><a href="#Mapping">path属性とActionクラスのマッピングについて</a></li></ul><h2><a name="Summary">S2Struts概要</a></h2><p>S2Strutsを使うと、S2と<a href="http://struts.apache.org/">Struts</a>が簡単に連動するようになります。Actionクラスにサービスコンポーネントが自動的に設定されるので、Actionクラスの役割は適切なサービスコンポーネントを呼び出すだけになります。Actionクラスはコントローラに徹することで、プレゼンテーション層とサービス層の役割分担も明確になります。また、Actionに対して<a href="http://homepage3.nifty.com/seasar/aop.html">AOP</a>を適用することもできます。</p><h2><a name="Setup">動作環境とEclipseプロジェクトのセットアップ</a></h2><p>S2と同様にJDK1.4以上が必要です。</p><p>S2StrutsVx.x.x.jarを解凍してできたs2strutsディレクトリをEclipseのJavaプロジェクトとして丸ごとインポートしてください。.classpathを上書きするか聞かれるので、全て、はいのボタンをクリックして、全てを取り込みます。これで、私と全く同じ開発環境になります。</p><p>サンプルは、<a href="http://jakarta.apache.org/tomcat/">Tomcat</a>と<a href="http://www.sysdeo.com/eclipse/tomcatPlugin.html">Tomcat Plugin</a>を使うことを前提にしています。あらかじめインストールして置いてください。サンプルはS2StrutsExamleVx.x.x.jarとして別途用意されているので、ダウンロードして解凍してください。Eclipseでs2struts-exampleという名前でJavaプロジェクトを作成します。Tomcatプロジェクトではないので気をつけてください。解凍してできたs2struts-exampleディレクトリを丸ごとインポートしてください。.classpathを上書きするか聞かれるので、全て、はいのボタンをクリックして、全てを取り込みます。s2struts-exampleプロジェクトを右クリックしてプロパティ-&gt;Tomcatを選びます。Tomcatプロジェクトであるをチェックし、アプリケーションURIを/s2struts-exampleとします。これで、Tomcatを再起動して、ブラウザから<a href="http://localhost:8080/s2struts-example/">http://localhost:8080/s2struts-example/</a>にアクセスすると四則演算のサンプルを見ることができます。</p><h2><a name="Usage">基本的な使い方</a></h2><p>まず、S2Containerを起動するためにS2StrutsServletをweb.xmlに登録する必要があります。</p><h3>web.xml</h3><pre>&lt;web-app&gt;  &lt;display-name&gt;Struts Application&lt;/display-name&gt;  <b>&lt;servlet&gt;    &lt;servlet-name&gt;s2container&lt;/servlet-name&gt;    &lt;servlet-class&gt;<font color="red">org.seasar.struts.S2StrutsServlet</font>&lt;/servlet-class&gt;    &lt;load-on-startup/&gt;  &lt;/servlet&gt;</b>    &lt;!-- Standard Action Servlet Configuration (with debugging) --&gt;  &lt;servlet&gt;    &lt;servlet-name&gt;action&lt;/servlet-name&gt;    &lt;servlet-class&gt;org.apache.struts.action.ActionServlet&lt;/servlet-class&gt;    &lt;init-param&gt;      &lt;param-name&gt;config&lt;/param-name&gt;      &lt;param-value&gt;/WEB-INF/struts-config.xml&lt;/param-value&gt;    &lt;/init-param&gt;    &lt;init-param&gt;      &lt;param-name&gt;debug&lt;/param-name&gt;      &lt;param-value&gt;2&lt;/param-value&gt;    &lt;/init-param&gt;    &lt;init-param&gt;      &lt;param-name&gt;detail&lt;/param-name&gt;      &lt;param-value&gt;2&lt;/param-value&gt;    &lt;/init-param&gt;    &lt;load-on-startup&gt;2&lt;/load-on-startup&gt;  &lt;/servlet&gt;  &lt;servlet-mapping&gt;    &lt;servlet-name&gt;s2container&lt;/servlet-name&gt;    &lt;url-pattern&gt;/s2container&lt;/url-pattern&gt;  &lt;/servlet-mapping&gt;</p><p> &lt;!-- Standard Action Servlet Mapping --&gt;<br />  &lt;servlet-mapping&gt;    &lt;servlet-name&gt;action&lt;/servlet-name&gt;    &lt;url-pattern&gt;*.do&lt;/url-pattern&gt;  &lt;/servlet-mapping&gt;</p><p> &lt;!-- The Usual Welcome File List --&gt;<br />  &lt;welcome-file-list&gt;    &lt;welcome-file&gt;index.jsp&lt;/welcome-file&gt;  &lt;/welcome-file-list&gt;</p><p> &lt;!-- Struts Tag Library Descriptors --&gt;<br />  &lt;taglib&gt;    &lt;taglib-uri&gt;/tags/struts-bean&lt;/taglib-uri&gt;    &lt;taglib-location&gt;/WEB-INF/struts-bean.tld&lt;/taglib-location&gt;  &lt;/taglib&gt;</p><p>  &lt;taglib&gt;    &lt;taglib-uri&gt;/tags/struts-html&lt;/taglib-uri&gt;    &lt;taglib-location&gt;/WEB-INF/struts-html.tld&lt;/taglib-location&gt;  &lt;/taglib&gt;</p><p>  &lt;taglib&gt;    &lt;taglib-uri&gt;/tags/struts-logic&lt;/taglib-uri&gt;    &lt;taglib-location&gt;/WEB-INF/struts-logic.tld&lt;/taglib-location&gt;  &lt;/taglib&gt;</p><p>  &lt;taglib&gt;    &lt;taglib-uri&gt;/tags/struts-nested&lt;/taglib-uri&gt;    &lt;taglib-location&gt;/WEB-INF/struts-nested.tld&lt;/taglib-location&gt;  &lt;/taglib&gt;</p><p>  &lt;taglib&gt;    &lt;taglib-uri&gt;/tags/struts-tiles&lt;/taglib-uri&gt;    &lt;taglib-location&gt;/WEB-INF/struts-tiles.tld&lt;/taglib-location&gt;  &lt;/taglib&gt;</p>&lt;/web-app&gt;</pre><p>次に、S2とStrutsを連動させるために、S2用のRequestProcessorをstruts-config.xmlに登録する必要があります。S2RequestProcessorとS2TilesRequestProcessorを用意しています。これらは、それぞれ、Strutsの、RequestProcessorとTilesRequestProcessorに相当します。</p><h3>struts-config.xml</h3><pre>&lt;struts-config&gt;  ...  <b>&lt;controller processorClass=&quot;<font color="red">org.seasar.struts.S2RequestProcessor</font>&quot;/&gt;</b>  ...&lt;/struts-config&gt;</pre><p>上記のRequestProcessorから生成される全てのActionクラスがS2と連動するようになります。S2と連動するActionを、明示的にコンポーネント定義に登録しておく必要はありません(<a href="#Add.dicon">Add.dicon</a>)。インターフェースに対するセッターメソッドを定義しておけば、自動的に<a href="DIContainer.html#SetterInjection">セッター・インジェクション</a>が行われます。また、インターフェースのみが引数の、コンストラクタを定義している場合は、自動的に、<a href="DIContainer.html#ConstructorInjection">コンストラクタ・インジェクション</a>が行われます。</p><h3><a name="Add.dicon"></a>Add.dicon</h3><pre>&lt;components&gt;  &lt;component class=&quot;org.seasar.struts.examples.AddServiceImpl&quot;/&gt;&lt;/components&gt;</pre><p>ただし、Actionに対して、<a href="DIContainer.html#Aop">AOPの適用</a>や、<a href="DIContainer.html#MethodInjection">メソッド・インジェクション</a>を行いたい場合、また、コンポーネントの依存関係が、型によって自動的に解決されない場合などには、他のコンポーネントと同様に、コンポーネント定義にActionクラスを登録しておく必要があります(<a href="#Multiply.dicon">Multiply.dicon</a>)。</p><h3><a name="Multiply.dicon"></a>Multiply.dicon</h3><pre>&lt;components&gt;  <b>&lt;component class=&quot;org.seasar.struts.examples.MultiplyAction&quot;&gt;    &lt;initMethod>#out.println(&quot;inited MultiplyAction&quot;)&lt;/initMethod&gt;    &lt;aspect pointcut=&quot;execute&quot;&gt;      &lt;component class=&quot;org.seasar.framework.aop.interceptors.TraceInterceptor&quot;&gt;    &lt;/aspect&gt;  &lt;/component&gt;</b>  &lt;component class=&quot;org.seasar.struts.examples.MultiplyServiceImpl&quot;/&gt;&lt;/components&gt;</pre><p>また、これらの定義ファイルは、アプリケーション全体の定義である<a href="#app.dicon">app.dicon</a>に登録する必要があります。</p><h3><a name="app.dicon"></a>app.dicon</h3><pre>&lt;components&gt;  &lt;include path=&quot;org/seasar/struts/examples/Add.dicon&quot;/&gt;  &lt;include path=&quot;org/seasar/struts/examples/Subtract.dicon&quot;/&gt;  &lt;include path=&quot;org/seasar/struts/examples/Multiply.dicon&quot;/&gt;  &lt;include path=&quot;org/seasar/struts/examples/Divide.dicon&quot;/&gt;&lt;/components&gt;</pre><p>サービスコンポーネントを受け取るためにActionクラスはコンストラクタもしくはセッターメソッドを定義しておきます。execute()メソッドでは、サービスに処理を委譲するのみとなるので、非常にすっきりしたコードになっていることが分かると思います。</p><h3>AddAction</h3><pre>package org.seasar.struts.examples;import javax.servlet.http.HttpServletRequest;import javax.servlet.http.HttpServletResponse;import org.apache.struts.action.Action;import org.apache.struts.action.ActionForm;import org.apache.struts.action.ActionForward;import org.apache.struts.action.ActionMapping;public class AddAction extends Action {    private AddService addService_;    public AddAction(AddService addService) {        addService_ = addService;    }    public ActionForward execute(        ActionMapping mapping,        ActionForm form,        HttpServletRequest request,        HttpServletResponse response) {        CalculationForm calForm = (CalculationForm) form;        int result = addService_.add(calForm.getArg1(), calForm.getArg2());        calForm.setResult(result);        return (mapping.findForward("success"));    }}</pre><h2><a name="ProxyAction">ProxyActionクラスの使い方</a></h2><p>また、ProxyActionクラスを使用して、コンポーネント定義ファイルに記述したActionを呼び出し、処理を委譲する事もできます。これにより、struts-configとコンポーネント定義ファイルに同じクラス名を定義/同期する必要がなくなります。<b>struts-config内に記述しているactionのpath属性と、コンポーネント定義ファイルに定義したcomponentのname属性が一致している必要があります。</b>詳細は、<a href="#Mapping">「path属性とActionクラスのマッピングについて」</a>を参照してください。</p>また、ProxyActionクラスのみに関しては、struts-configに、S2用のRequestProcessorを登録しなくとも、S2と連動する事ができます。ただし、他のActionクラスもS2と連動させたい場合には、前述のように、S2用のRequestProcessorをstruts-config.xmlに登録する必要があります。これは、特定のActionクラスのみを、S2と連動する為に有効である事を意味します。<p><h3>struts-config.xml</h3><pre>&lt;struts-config&gt;  ...  &lt;action-mappings&gt;    ...    &lt;action      path=&quot;<b>/subtract</b>&quot;      type=&quot;org.seasar.struts.ProxyAction&quot;      name=&quot;calcForm&quot;      scope=&quot;request&quot;      validate=&quot;false&quot;      input=&quot;/pages/subtractInput.jsp&quot;&gt;      &lt;forward name=&quot;success&quot; path=&quot;/pages/result.jsp&quot; /&gt;    &lt;/action&gt;    ...  &lt;action-mappings&gt;  ...&lt;/struts-config&gt;</pre><h3>Subtract.dicon</h3><pre>&lt;components&gt;  &lt;component name=&quot;<b>/subtract</b>&quot; class=&quot;org.seasar.struts.examples.SubtractAction&quot; instance=&quot;prototype&quot;/&gt;  &lt;component class=&quot;org.seasar.struts.examples.SubtractServiceImpl&quot;/&gt;&lt;/components&gt;</pre>（インスタンス属性は、任意です。この引き算のサンプルでは、足し算、掛け算のサンプルとの比較のために、prototypeを指定しています。singletonとするのであれば、明示的な指定の必要はないでしょう。）</p><h2><a name="NoType">struts-config内に記述しているactionの、type属性を記述せずにActionクラスを指定する</a></h2><p>ProxyActionクラスの使い方と同様に、struts-config内に記述しているactionのpath属性と、コンポーネント定義ファイルに定義したcomponentのname属性を一致させる事によりtype属性を記述せずにActionクラスを呼び出す事が出来ます。詳細は、<a href="#Mapping">「path属性とActionクラスのマッピングについて」</a>を参照してください。この手法を利用する為には条件があります。それは、type属性、forward属性、include属性の3つの属性が無い事です。これにより、struts-configとコンポーネント定義ファイルに同じクラス名を定義/同期する必要がなくなります。<h3>struts-config.xml</h3><pre>&lt;struts-config&gt;  ...  &lt;action-mappings&gt;    ...    &lt;action      path=&quot;<b>/divide</b>&quot;      name=&quot;calcForm&quot;      scope=&quot;request&quot;      validate=&quot;false&quot;      input=&quot;/pages/divideInput.jsp&quot;&gt;      &lt;forward name=&quot;success&quot; path=&quot;/pages/result.jsp&quot; /&gt;    &lt;/action&gt;    ...  &lt;action-mappings&gt;  ...&lt;/struts-config&gt;</pre><h3>Divide.dicon</h3><pre>&lt;components&gt;  &lt;component name=&quot;<b>/divide</b>&quot; class=&quot;org.seasar.struts.examples.DivideAction&quot;/&gt;  &lt;component class=&quot;org.seasar.struts.examples.DivideServiceImpl&quot;/&gt;&lt;/components&gt;</pre></p><h2><a name="Mapping">path属性とActionクラスのマッピングについて</a></h2><p>ここでは、前述の<a href="#ProxyAction">「ProxyActionクラスの使い方」</a>と、<a href="#NoType">「struts-config内に記述しているactionの、type属性を記述せずにActionクラスを指定する」</a>で行った、path属性とActionクラスのマッピングについての、詳細情報を記述します。</p><p>以下の、web.xml、struts-config、そして、コンポーネント定義ファイルが存在するとします。<h3>web.xml</h3><pre>&lt;web-app&gt;  ...  &lt;servlet&gt;    &lt;servlet-name&gt;action&lt;/servlet-name&gt;    &lt;servlet-class&gt;org.apache.struts.action.ActionServlet&lt;/servlet-class&gt;    &lt;init-param&gt;      &lt;param-name&gt;<b>config</b>&lt;/param-name&gt;      &lt;param-value&gt;/WEB-INF/struts-config.xml&lt;/param-value&gt;    &lt;/init-param&gt;    &lt;init-param&gt;      &lt;param-name&gt;<b>config<font color="red">/foo</font></b>&lt;/param-name&gt;      &lt;param-value&gt;/WEB-INF/struts-config-foo.xml&lt;/param-value&gt;    &lt;/init-param&gt;    ...  &lt;/servlet&gt;  ...&lt;/web-app&gt;</pre><h3>struts-config.xml</h3><pre>&lt;struts-config&gt;  ...  &lt;action-mappings&gt;    ...    &lt;action <b>path=&quot;<font color="red">/bar</font>&quot;</b>      ...    &lt;/action&gt;    ...  &lt;action-mappings&gt;  ...&lt;/struts-config&gt;</pre><h3>struts-config-foo.xml</h3><pre>&lt;struts-config&gt;  ...  &lt;action-mappings&gt;    ...    &lt;action <b>path=&quot;<font color="red">/baz</font>&quot;</b>      ...    &lt;/action&gt;    ...  &lt;action-mappings&gt;  ...&lt;/struts-config&gt;</pre><h3>コンポーネント定義ファイル</h3><pre>&lt;components&gt;  &lt;component <b>name=&quot;<font color="red">/bar</font>&quot;</b> class=&quot;BarAction&quot;/&gt;  &lt;component <b>name=&quot;<font color="red">/foo/baz</font>&quot;</b> class=&quot;BazAction&quot;/&gt;&lt;/components&gt;</pre></p><p>デフォルトのモジュール（struts-config.xmlで動作するモジュール）であれば、struts-config内に記述しているactionタグのpath属性と、コンポーネント定義ファイル内に記述しているcomponentタグのname属性でマッピングを行います。下記のサブモジュールの(2)のパターンになります。</p><p>サブモジュール（この例では、struts-config-foo.xmlで動作するモジュール）であれば、マッピング方法が２つ存在します。<ul>(1)モジュール(prefix)名（<b><font color="red">/foo</font></b>）+path属性（<b><font color="red">/baz</font></b>）=name属性（<b><font color="red">/foo/baz</font></b>）<br>(2)path属性（<b><font color="red">/baz</font></b>）=name属性（<b><font color="red">/foo/baz</font></b>）</ul>コンポーネントを取得する優先順位は、(1)、(2)の順になります。つまり、名前が/foo/bazであるコンポーネントが見つからなければ、名前が/bazであるコンポーネントを取得します。</p><!-- document end --><!-- don't edit start --></td><td width="14"><img height="14" width="14" src="images/spacer.gif" alt=""></td></tr><tr><td width="14"><img height="30" width="14" src="images/spacer.gif" alt=""></td><td width="766"><img height="30" width="592" src="images/spacer.gif" alt=""></td></tr><tr><td width="14"><img height="14" width="14" src="images/spacer.gif" alt=""></td><td width="766" class="copyright">&copy; Copyright The Seasar Project and the others 2004, all rights reserved.</td></tr></table><td class="backright" align="left" valign="top">&nbsp;</td></tr><tr><td class="backunder" align="left"  valign="top" width="780" height="16">&nbsp;</td><td class="backcorner" align="left" valign="top" height="16">&nbsp;</td></tr></table></body><!-- don't edit end --></html>